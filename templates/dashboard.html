{% extends "base.html" %}

{% block content %}
<div class="container mt-5 text-light animate__animated animate__fadeIn">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-bolt me-2 text-warning"></i>Real-Time Snort Alerts</h2>
        <span class="badge bg-secondary fs-6">Live Feed <i class="fas fa-sync-alt fa-spin ms-1"></i></span>
    </div>

    <div id="realtime-alerts" class="rounded shadow-sm p-3 bg-dark border border-secondary">
        <div class="text-center py-5 text-muted">
            <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
            <p class="mb-0">Loading real-time alerts...</p>
        </div>
    </div>
</div>

<script>
function fetchAlerts() {
    fetch('/api/realtime-alerts')
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById('realtime-alerts');
            if (!data.length) {
                container.innerHTML = '<div class="alert alert-info">⚠️ No real-time alerts available.</div>';
                return;
            }

            let html = `
                <div class="table-responsive animate__animated animate__fadeInUp">
                    <table class="table table-dark table-hover table-bordered border-secondary shadow-sm">
                        <thead class="table-light text-dark">
                            <tr>
                                <th>Timestamp</th>
                                <th>Source IP</th>
                                <th>Destination IP</th>
                                <th>Protocol</th>
                                <th>Message</th>
                                <th>Severity</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            data.forEach(alert => {
                const badge = alert.severity === 'high' ? 'bg-danger' :
                              alert.severity === 'medium' ? 'bg-warning text-dark' : 'bg-success';
                html += `
                    <tr>
                        <td>${alert.timestamp}</td>
                        <td>${alert.src_ip}</td>
                        <td>${alert.dest_ip}</td>
                        <td>${alert.protocol}</td>
                        <td>${alert.message}</td>
                        <td><span class="badge ${badge}">${alert.severity.toUpperCase()}</span></td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        });
}

fetchAlerts();
setInterval(fetchAlerts, 5000);
</script>
{% endblock %}
